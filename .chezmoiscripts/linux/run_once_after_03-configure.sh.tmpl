#!/bin/bash

set -eufo pipefail
echo "03-configure.sh"

# change shell
sudo chsh -s $(which zsh) $USER

# set hostname
sudo hostnamectl set-hostname $(echo "$DEVICE_NAME" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
sudo hostnamectl set-hostname "$DEVICE_NAME" --pretty

{{ if .host.headless }}
# firewall
# tailscale status give error exit 1
ufw_status=$(sudo ufw status | grep -w "Status:")
if [[ $ufw_status == *"Status: active"* ]]; then
    echo "ufw is active"
else
    echo "ufw is inactive"
fi
sudo ufw status verbose

# docker
sudo usermod -aG docker $USER
{{ end }}

# done
echo "done. note that some of these changes require a logout/restart to take effect"
